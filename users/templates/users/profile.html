{% extends 'layout.html' %}
{% load tz %} <!-- para adicionar a timezone na data do post -->
{% load static %}

{% block title %}
    {{ profile_user.username }}'s Profile
{% endblock %}

{% block content %}
<section>

    <img src="{{ profile_user.photo.url }}" alt="{{ profile_user.username }}" style="width:150px; height:150px; object-fit:cover; border-radius:50%; border: 2px solid #fff;">
   
    <h1>{{ profile_user.username }}</h1>

     {% if user_posts %}
        <ul>
            {% for post in user_posts %}
                <article class="post">
                    <h2>
                        <a href="{% url 'posts:page' slug=post.slug pk=post.pk %}">
                        {{ post.title }}
                        </a>
                    </h2>
                    {% if post.banner %}
                         <img src="{{ post.banner.url }}" alt="{{ post.title }}" style="max-width: 400px; width: 100%; height: auto; border-radius: 10px; margin-bottom: 1rem;">
                    {% else %}
                        <img src="{% static 'images/fallback.png' %}" alt="{{ post.title }}" style="max-width: 400px; width: 100%; height: auto;    border-radius: 10px; margin-bottom: 1rem;">
                    {% endif %}
                        <p>{{ post.body }}</p>
                        <p>{{ post.date|timezone:"America/Sao_Paulo" }} by {{ post.author }}</p>
                    {% if post.author == request.user %}
                        <div style="display: flex; gap: 10px; align-items: center;">
                            
                            <a href="{% url 'posts:update' pk=post.pk slug=post.slug %}">
                                <button class="form-submit">Update Post</button>
                            </a>

                        
                            <div id="delete-section">
                                <button id="show-confirm" class="form-submit">Delete Post</button>
                            </div>
                        </div>

                        
                        <div id="confirm-delete" style="display:none; margin-top:5px;">
                            <p><span>Are you sure you want to delete?</span></p>
                            <form action="{% url 'posts:delete' pk=post.pk slug=post.slug %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="form-submit">Yes</button>
                            </form>
                            <button id="cancel-delete" class="form-submit">No</button>
                        </div>

                        <script>
                            const showConfirm = document.getElementById('show-confirm');
                            const confirmDelete = document.getElementById('confirm-delete');
                            const cancelDelete = document.getElementById('cancel-delete');
                            
                            

                            showConfirm.addEventListener('click', () => {
                                showConfirm.style.display = 'none';
                                confirmDelete.style.display = 'block'; 
                            });

                            cancelDelete.addEventListener('click', () => {
                                showConfirm.style.display = 'inline';
                                confirmDelete.style.display = 'none';
                            });
                        </script>
                    {% endif %}


                </article>
            {% endfor %}
        </ul>
    {% else %}
        <p>This user hasn't posted anything yet</p>
    {% endif %}
</section>
{% endblock %}
